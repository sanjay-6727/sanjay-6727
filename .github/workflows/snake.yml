jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Pull latest changes
        run: git pull origin main

      - name: Generate Gotham SVG
        run: |
          mkdir -p dist
          cat << 'EOF' > dist/gotham.svg
          <svg width="900" height="200" xmlns="http://www.w3.org/2000/svg">
            <rect width="100%" height="100%" fill="#0a0a0a"/>

            <image href="https://ghchart.rshah.org/sanjay-6727"
                   x="50" y="30" height="140"/>

            <rect x="-300" y="0" width="300" height="200"
                  fill="url(#light)">
              <animate attributeName="x"
                       from="-300"
                       to="900"
                       dur="6s"
                       repeatCount="indefinite" />
            </rect>

            <defs>
              <linearGradient id="light" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="transparent"/>
                <stop offset="50%" stop-color="rgba(245,197,24,0.25)"/>
                <stop offset="100%" stop-color="transparent"/>
              </linearGradient>
            </defs>
          </svg>
          EOF

      - uses: EndBug/add-and-commit@v9
        with:
          add: "dist"
          message: "Update Gotham Signal"
          pull: '--rebase --autostash'
